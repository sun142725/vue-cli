webpackJsonp([1],[,,,,,function(t,e,n){"use strict";var s=n(18),a=n(136),i=n(121),o=n.n(i),r=n(112),c=n.n(r),u=n(114),l=n.n(u),d=n(115),p=n.n(d),f=n(113),m=n.n(f);s.a.use(a.a);var v=new a.a({mode:"history",routes:[{path:"/chatRoom",name:"chatRoom",component:p.a},{path:"/login",name:"login",component:m.a},{path:"/register",name:"register",component:l.a},{path:"/",redirect:"/keep"},{path:"/keep",name:"keep",component:o.a},{path:"/contact",name:"contact",component:c.a}]});v.beforeEach(function(t,e,n){"login"===t.name||"register"===t.name?n():localStorage._chat_user?n():v.push({path:"login"})}),e.a=v},,,,,,,,,,,,function(t,e,n){function s(t){n(96)}var a=n(1)(n(39),n(127),s,"data-v-4b2ae3ae",null);t.exports=a.exports},,,,,,,,,,,,,,,,,function(t,e,n){function s(t){n(101)}var a=n(1)(n(37),n(133),s,null,null);t.exports=a.exports},,,function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={name:"app"}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=n(51),a=n.n(s),i=n(17),o=n.n(i);e.default={name:"contact",data:function(){return{users:[],current:"A",heightArr:[],inited:!0}},methods:{to:function(t){console.log(t),document.body.scrollTop=this.heightArr[t]-64}},computed:{displayUser:function(){var t={};return this.users.forEach(function(e){var n=e.name_alias[0].toUpperCase();t[n]||(t[n]=[]),t[n].push(e)}),t},arr:function(){return a()(this.displayUser).sort(function(t,e){return t.charCodeAt(0)-e.charCodeAt(0)})}},mounted:function(){var t=this;fetch("/api/getAllUser").then(function(t){return t.json()}).then(function(e){t.users=e})},updated:function(){if(this.users.length&&this.inited){for(var t=this.$refs.left.querySelectorAll(".title"),e=0;e<t.length;e++)this.heightArr.push(t[e].offsetTop);var n=this;window.onscroll=function(){for(var t=document.body.scrollTop+64,e=0,s=0;s<n.heightArr.length;s++)if(t<=n.heightArr[s]){e=s;break}n.current=n.arr[e]},this.inited=!1}},components:{"app-header":o.a}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});n(5);e.default={name:"header"}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=n(9),a=n.n(s),i=n(5);e.default={name:"login",data:function(){return{account:"",password:""}},methods:{send:function(){fetch("/api/login",{credentials:"include",method:"POST",headers:{"Content-Type":"application/json"},body:a()({account:this.account,password:this.password})}).then(function(t){return t.text()}).then(function(t){t&&(localStorage._chat_user=t,i.a.push({name:"keep"}))})}}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=n(9),a=n.n(s),i=n(5);e.default={name:"register",data:function(){return{account:"",password:"",name:""}},methods:{submit:function(){fetch("/api/register",{method:"POST",headers:{"Content-Type":"application/json"},body:a()({name:this.name,account:this.account,password:this.password})}).then(function(t){return t.json()}).then(function(t){i.a.push({path:"login"})})}}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=n(17),a=n.n(s),i=n(28),o=n.n(i);e.default={name:"chatRoom",data:function(){return{uid:"",name:"",socket:null,message:"",messages:[],contacts:[]}},methods:{send:function(){this.messages.push({name:this.name,message:this.message}),this.socket.emit("message",{name:this.name,message:this.message}),this.message=""}},components:{"app-header":a.a},mounted:function(){var t=this,e=this;fetch("/api/getMyInfo",{credentials:"include"}).then(function(t){return t.json()}).then(function(t){e.uid=t.uid,e.name=t.name}),fetch("/api/getAllUser").then(function(t){return t.json()}).then(function(e){return t.contacts=e}),this.socket=o.a.connect("http://instantmessage.duapp.com:18080"),this.socket.on("broad",function(t){e.messages.push(t),console.log(t)}),this.socket.on("news",function(t){e.contacts=e.contacts.map(function(e){return t[e.id]?e.online=!0:e.online=!1,e}),console.log(t)})},updated:function(){this.$refs.content.scrollTop=this.$refs.ul.offsetHeight-370}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=n(52),a=n.n(s),i=n(117),o=n.n(i),r=n(119),u=n.n(r),l=n(28),d=n.n(l);c;var p=function t(e,n){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];a()(this,t),this.from=e,this.to=n,this.position=s,this.messages=i};e.default={name:"chat",data:function(){return{user:{},mini:!1,socket:null,onlineUsers:{},contacts:[],tabs:[]}},methods:{closeTab:function(t){this.tabs=this.tabs.filter(function(e){return e.to.id!=t})},hide:function(){this.mini=!0},show:function(){this.mini=!1},openTab:function(t){var e={};e.id=this.user.id,e.name=this.user.name,e.sid=this.onlineUsers[e.id];var n={};if(n.id=t.id,n.name=t.name,n.sid=this.onlineUsers[n.id],!this.tabs.filter(function(t){return t.to.id==n.id}).length){var s=new p(e,n);this.tabs.unshift(s),this.tabs=this.tabs.map(function(t,e){return t.position=300*(e+1),t})}},send:function(t,e){this.tabs.forEach(function(n,s){if(n.to.id==t.to.id){var a={type:"me",message:e};n.messages.push(a)}}),this.socket.emit("private",{data:t,message:e})},watchIncomingMesaage:function(){var t=this;this.socket.on("incomingMessage",function(e){var n={};n.id=t.user.id,n.name=t.user.name,n.sid=t.onlineUsers[n.id];var s={};s.id=e.data.from.id,s.name=e.data.from.name,s.sid=t.onlineUsers[s.id];var a=t.tabs.filter(function(t){return t.to.id==s.id});if(a.length){var i={type:"other",message:e.message};a[0].messages.push(i)}else{var o=new p(n,s),r={type:"other",message:e.message};o.messages.push(r),t.tabs.unshift(o),t.tabs=t.tabs.map(function(t,e){return t.position=300*(e+1),t})}})},getAllUser:function(){var t=this;fetch("/api/getAllUser").then(function(t){return t.json()}).then(function(e){e=e.filter(function(e){return e.id!=t.user.id}),t.contacts=e})},connect:function(){this.socket=d.a.connect("http://instantmessage.duapp.com:18080")},watchOnlineUser:function(){var t=this;this.socket.on("onlineUserChange",function(e){t.onlineUsers=e,t.contacts=t.contacts.map(function(e){return e.online=!!t.onlineUsers[e.id],e})})},init:function(){this.user=JSON.parse(localStorage._chat_user),this.getAllUser(),this.connect(),this.watchOnlineUser(),this.watchIncomingMesaage()}},mounted:function(){this.init()},components:{"chat-tab":o.a,MessageInput:u.a}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=n(118),a=n.n(s);e.default={name:"chat-tab",props:["data"],data:function(){return{mini:!1}},methods:{closeTab:function(t){this.$emit("close",t)},send:function(t){this.$emit("send",t)},hide:function(){this.mini=!0},show:function(){this.mini=!1}},components:{Message:a.a}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={props:["data"]}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={name:"message-input",props:["data"],data:function(){return{message:""}},methods:{submit:function(){this.$emit("send",this.data,this.message),this.message=""}}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={name:"AddNote",data:function(){return{open:!1,title:"",content:"",notes:[]}},methods:{showCard:function(){this.open=!0},addNode:function(){this.open=!1,this.$emit("insert",{id:1,title:this.title,content:this.content}),this.title="",this.content=""}}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=n(9),a=n.n(s),i=n(17),o=n.n(i),r=n(120),c=n.n(r),u=n(122),l=n.n(u),d=n(116),p=n.n(d);e.default={name:"keep",data:function(){return{notes:[]}},methods:{insert:function(t){this.notes.push(t)}},watch:{notes:function(){localStorage.notes=a()(this.notes)}},mounted:function(){localStorage.notes&&(this.notes=JSON.parse(localStorage.notes))},components:{"app-header":o.a,AddNote:c.a,Note:l.a,Chat:p.a}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={props:{data:Object}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=n(18),a=n(34),i=n.n(a),o=n(5);s.a.config.productionTip=!1,new s.a({el:"#app",router:o.a,template:"<App/>",components:{App:i.a}})},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},,,,,,,,,,function(t,e,n){function s(t){n(98)}var a=n(1)(n(38),n(129),s,"data-v-4ea5ea62",null);t.exports=a.exports},function(t,e,n){var s=n(1)(n(40),n(131),null,null,null);t.exports=s.exports},function(t,e,n){var s=n(1)(n(41),n(135),null,null,null);t.exports=s.exports},function(t,e,n){function s(t){n(94)}var a=n(1)(n(42),n(125),s,"data-v-417db93e",null);t.exports=a.exports},function(t,e,n){function s(t){n(99)}var a=n(1)(n(43),n(130),s,"data-v-56fab95e",null);t.exports=a.exports},function(t,e,n){function s(t){n(102)}var a=n(1)(n(44),n(134),s,"data-v-cf8519f2",null);t.exports=a.exports},function(t,e,n){function s(t){n(97)}var a=n(1)(n(45),n(128),s,null,null);t.exports=a.exports},function(t,e,n){function s(t){n(93)}var a=n(1)(n(46),n(124),s,null,null);t.exports=a.exports},function(t,e,n){function s(t){n(100)}var a=n(1)(n(47),n(132),s,"data-v-6ff543ca",null);t.exports=a.exports},function(t,e,n){function s(t){n(95)}var a=n(1)(n(48),n(126),s,"data-v-45468504",null);t.exports=a.exports},function(t,e,n){function s(t){n(92)}var a=n(1)(n(49),n(123),s,null,null);t.exports=a.exports},function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"note"},[n("h3",[t._v(t._s(t.data.title))]),t._v("\n    "+t._s(t.data.content)+"\n")])},staticRenderFns:[]}},function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"message-input"}},[n("textarea",{directives:[{name:"model",rawName:"v-model",value:t.message,expression:"message"}],attrs:{placeholder:"Type a message"},domProps:{value:t.message},on:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13))return null;t.submit(e)},input:function(e){e.target.composing||(t.message=e.target.value)}}})])},staticRenderFns:[]}},function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("app-header"),t._v(" "),n("div",{staticClass:"container"},[n("div",{ref:"content",attrs:{id:"content"}},[n("ul",{ref:"ul"},t._l(t.messages,function(e){return n("li",[n("span",[t._v(t._s(e.name)+":")]),t._v(" "),n("span",[t._v(t._s(e.message))])])}))]),t._v(" "),n("div",{attrs:{id:"contact"}},[t._v("\n            ---------------在线\n            "),n("ul",t._l(t.contacts.filter(function(t){return t.online}),function(e){return n("li",[t._v("\n                    "+t._s(e.name)+"\n                ")])})),t._v("\n            ---------------离线\n            "),n("ul",t._l(t.contacts.filter(function(t){return!t.online}),function(e){return n("li",[t._v("\n                    "+t._s(e.name)+"\n                ")])}))]),t._v(" "),n("div",{attrs:{id:"input"}},[n("textarea",{directives:[{name:"model",rawName:"v-model",value:t.message,expression:"message"}],domProps:{value:t.message},on:{input:function(e){e.target.composing||(t.message=e.target.value)}}}),t._v(" "),n("button",{on:{click:t.send}},[t._v("发文本")])])])],1)},staticRenderFns:[]}},function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"keep"},[n("app-header"),t._v(" "),n("div",{staticClass:"container"},[n("AddNote",{on:{insert:t.insert}}),t._v(" "),n("ul",{staticClass:"note-list"},t._l(t.notes,function(t){return n("Note",{attrs:{data:t}})}))],1),t._v(" "),n("Chat")],1)},staticRenderFns:[]}},function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"header"},[n("ul",{staticClass:"menu"},[n("li",[n("router-link",{attrs:{to:{name:"keep"}}},[t._v("keep")])],1),t._v(" "),n("li",[n("router-link",{attrs:{to:{name:"contact"}}},[t._v("contact")])],1),t._v(" "),n("li",[n("router-link",{attrs:{to:{name:"chatRoom"}}},[t._v("chatRoom")])],1)])])},staticRenderFns:[]}},function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{class:"message-wrapper "+t.data.type},[n("div",{staticClass:"message"},[t._v("\n        "+t._s(t.data.message)+"\n    ")])])},staticRenderFns:[]}},function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"contact"},[n("app-header"),t._v(" "),n("div",{staticClass:"container"},[n("div",{staticClass:"tips"},[t._v("\n            "+t._s(t.current)+"\n        ")]),t._v(" "),n("div",{ref:"left",staticClass:"left"},t._l(t.arr,function(e){return n("div",{staticClass:"group"},[n("div",{staticClass:"title"},[t._v(t._s(e))]),t._v(" "),n("ul",t._l(t.displayUser[e],function(e){return n("li",[n("span",[t._v(t._s(e.name))])])}))])})),t._v(" "),n("div",{staticClass:"right",style:{height:22*t.arr.length+"px"}},[n("ul",t._l(t.arr,function(e,s){return n("li",{class:e==t.current?"active":"",on:{click:function(e){t.to(s)}}},[t._v("\n                   "+t._s(e)+"\n                ")])}))])])],1)},staticRenderFns:[]}},function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("transition",{attrs:{appear:"","appear-class":"fly","appear-to-class":"a","appear-active-class":"b"}},[n("div",{attrs:{id:"chat"}},[n("div",{staticClass:"chat-wrapper"},[n("div",{directives:[{name:"show",rawName:"v-show",value:!t.mini,expression:"!mini"}],staticClass:"chat-large"},[n("div",{staticClass:"chat-header",on:{click:t.hide}},[t._v("\n                    chat\n                ")]),t._v(" "),n("div",{staticClass:"friend-list"},[n("ul",[t._l(t.contacts.filter(function(t){return t.online}),function(e){return n("li",{key:e.id,on:{click:function(n){t.openTab(e)}}},[n("div",{staticClass:"u-pic"}),t._v(" "),n("div",{staticClass:"u-name"},[t._v(t._s(e.name))]),t._v(" "),e.online?n("div",{staticClass:"last-online-time",staticStyle:{color:"#4cae4c"}},[t._v("online")]):n("div",{staticClass:"last-online-time"},[t._v("offline")])])}),t._v(" "),t._l(t.contacts.filter(function(t){return!t.online}),function(e){return n("li",{key:e.id,on:{click:function(n){t.openTab(e)}}},[n("div",{staticClass:"u-pic"}),t._v(" "),n("div",{staticClass:"u-name"},[t._v(t._s(e.name))]),t._v(" "),e.online?n("div",{staticClass:"last-online-time",staticStyle:{color:"#4cae4c"}},[t._v("online")]):n("div",{staticClass:"last-online-time"},[t._v("offline")])])})],2)]),t._v(" "),n("div",{staticClass:"search"})]),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:t.mini,expression:"mini"}],staticClass:"chat-mini",on:{click:t.show}},[t._v("\n                chat\n            ")])]),t._v(" "),t._l(t.tabs,function(e,s){return n("chat-tab",{key:s,attrs:{data:e},on:{close:t.closeTab}},[n("MessageInput",{attrs:{data:e},on:{send:t.send}})],1)})],2)])},staticRenderFns:[]}},function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"login"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.account,expression:"account"}],attrs:{type:"text",placeholder:"account",name:"account"},domProps:{value:t.account},on:{input:function(e){e.target.composing||(t.account=e.target.value)}}}),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:t.password,expression:"password"}],attrs:{type:"password",placeholder:"password",name:"password"},domProps:{value:t.password},on:{input:function(e){e.target.composing||(t.password=e.target.value)}}}),t._v(" "),n("input",{attrs:{type:"submit",value:"登录"},on:{click:t.send}}),t._v(" "),n("router-link",{attrs:{to:{name:"register"}}},[t._v("去注册")])],1)},staticRenderFns:[]}},function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"containers"},[n("div",{directives:[{name:"show",rawName:"v-show",value:!t.open,expression:"!open"}],staticClass:"input",on:{click:t.showCard}},[t._v("添加记事...")]),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:t.open,expression:"open"}],staticClass:"card"},[n("div",{staticClass:"title"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.title,expression:"title"}],attrs:{type:"text",placeholder:"标题"},domProps:{value:t.title},on:{input:function(e){e.target.composing||(t.title=e.target.value)}}})]),t._v(" "),n("div",{staticClass:"content"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.content,expression:"content"}],attrs:{type:"text",placeholder:"添加记事..."},domProps:{value:t.content},on:{input:function(e){e.target.composing||(t.content=e.target.value)}}})]),t._v(" "),n("div",{staticClass:"button",on:{click:t.addNode}},[t._v("完成")])])])},staticRenderFns:[]}},function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[n("router-view")],1)},staticRenderFns:[]}},function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"chat-tab"}},[n("div",{staticClass:"chat-tab-wrapper",style:{right:t.data.position+"px"}},[n("div",{directives:[{name:"show",rawName:"v-show",value:!t.mini,expression:"!mini"}],staticClass:"chat-tab-large"},[n("div",{staticClass:"chat-tab-header",on:{click:t.hide}},[t._v("\n                "+t._s(t.data.to.name)+"\n                "),n("div",{staticClass:"close",on:{click:function(e){e.stopPropagation(),t.closeTab(t.data.to.id)}}},[t._v("x")])]),t._v(" "),n("div",{staticClass:"chat-list"},t._l(t.data.messages,function(t,e){return n("div",{key:e},[n("Message",{attrs:{data:t}})],1)})),t._v(" "),t._t("default")],2),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:t.mini,expression:"mini"}],staticClass:"chat-tab-mini",on:{click:t.show}},[t._v("\n            "+t._s(t.data.to.name)+"\n        ")])])])},staticRenderFns:[]}},function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"register"},[n("form",{attrs:{action:"/api/register",method:"post"},on:{submit:function(e){e.preventDefault(),t.submit(e)}}},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.account,expression:"account"}],attrs:{type:"text",placeholder:"account",name:"account"},domProps:{value:t.account},on:{input:function(e){e.target.composing||(t.account=e.target.value)}}}),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:t.password,expression:"password"}],attrs:{type:"password",placeholder:"password",name:"password"},domProps:{value:t.password},on:{input:function(e){e.target.composing||(t.password=e.target.value)}}}),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:t.name,expression:"name"}],attrs:{type:"text",placeholder:"name",name:"name"},domProps:{value:t.name},on:{input:function(e){e.target.composing||(t.name=e.target.value)}}}),t._v(" "),n("input",{attrs:{type:"submit",value:"注册"}})])])},staticRenderFns:[]}},,,,function(t,e){}],[50]);
//# sourceMappingURL=app.7d0da460b2a4f6f3e89b.js.map